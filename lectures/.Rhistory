sort(bootci$slp)[975]
compare_ci <- data.frame(label=c("classical", "bootstrap"),
l = c(coefs[2,2] - qt(0.975, n-2)*coefs[2,3], sort(bootci$slp)[25]),
u = c(coefs[2,2]+qt(0.975, n-2)*coefs[2,3], sort(bootci$slp)[975]))
compare_ci
?geom_segment
ggplot(compare_ci) + geom_segment(x=l, xend=u, y=label, yend=label)
ggplot(compare_ci) + geom_segment(aes(x=l, xend=u, y=label, yend=label))
ggplot(compare_ci) + geom_segment(aes(x=l, xend=u, y=label, yend=label)) +
geom_vline(xintercept=coefs[2,2], colour="red")
bootci <- data.frame(dfpred=rep(NA, 1000), dfnewp=rep(NA, 1000))
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
bootci$dfpred[i] <- predict(df_lm, newdat)
}
library(dplyr)
library(tidyr)
library(ggplot2)
library(readr)
library(gridExtra)
olympics2008 <- read_csv("../data/olympics2008.csv")
olympics2012 <- read_csv("../data/olympics2012.csv")
oly <- merge(olympics2012[,c("Country","Total")],
olympics2008[,c("Country","Total")], by="Country",
all.x=TRUE)
colnames(oly)[2] <- "M2012"
colnames(oly)[3] <- "M2008"
oly <- oly %>% filter(!is.na(M2008))
oly$M2008 <- log10(oly$M2008+1)
oly$M2012 <- log10(oly$M2012+1)
oly_lm <- glm(M2012~M2008, data=oly)
library(broom)
kable(tidy(oly_lm))
coefs <- tidy(oly_lm)
library(knitr)
newdat <- data.frame(M2008=seq(0, 2.2, 0.1), M2012=NA)
oly_lm_p <- predict(oly_lm, newdat, se.fit=TRUE)
newdat$M2012 <- oly_lm_p$fit
newdat$se.fit <- oly_lm_p$se.fit
dim(newdat)
bootci <- data.frame(dfpred_l=rep(NA, nrow(newdat)), dfpred_u=rep(NA, nrow(newdat)))
for (j in 1:nrow(newdat)) {
x <- newdat[i,]
pred <- NULL
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
bootci <- data.frame(dfpred_l=rep(NA, nrow(newdat)), dfpred_u=rep(NA, nrow(newdat)))
for (j in 1:nrow(newdat)) {
x <- newdat[j,]
pred <- NULL
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
bootci
bootci <- data.frame(M2008=newdat$M2008, l=rep(NA, nrow(newdat)), u=rep(NA, nrow(newdat)))
for (j in 1:nrow(newdat)) {
x <- newdat[j,]
pred <- NULL
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
head(bootci)
ggplot(oly, aes(x=M2008, y=M2012)) + geom_point(alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=bootci, aes(x=M2008, ymin=l, ymax=u), colour="red") +
geom_line(data=newdat, aes(x=M2008, y=l), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=u), linetype=2)
ggplot(oly, aes(x=M2008, y=M2012)) + geom_point(alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=bootci, aes(x=M2008, ymin=l, ymax=u), colour="red") +
geom_line(data=bootci, aes(x=M2008, y=l), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=u), linetype=2)
head(oly)
ggplot(oly, aes(x=M2008, y=M2012)) + geom_point(alpha=0.3)
ggplot(oly, aes(x=M2008, y=M2012)) + geom_point(alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103)
ggplot(oly, aes(x=M2008, y=M2012)) + geom_point(alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=bootci, aes(x=M2008, ymin=l, ymax=u), colour="red")
head(bootci)
?geom_linerange
ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=bootci, aes(x=M2008, ymin=l, ymax=u), colour="red") +
geom_line(data=bootci, aes(x=M2008, y=l), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=u), linetype=2)
ggplot(oly) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_line(data=bootci, aes(x=M2008, y=l), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=u), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=M2012-se.fit), linetype=3, colour="grey60") +
geom_line(data=newdat, aes(x=M2008, y=M2012+se.fit), linetype=3, colour="grey60")
ggplot(oly) +
geom_line(data=bootci, aes(x=M2008, y=l), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=u), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=M2012-se.fit), linetype=1, colour="grey60") +
geom_line(data=newdat, aes(x=M2008, y=M2012+se.fit), linetype=1, colour="grey60") +
ylab("M2012") + ggtitle("Comparison with t-intervals")
head(newdat)
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
res <- residuals(df_lm)
res
head(newdat)
bootci <- data.frame(l=rep(NA,1000), u=rep(NA, 1000))
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
res <- sort(residuals(df_lm))
bootci$l[i] <- res[25]
bootci$u[i] <- res[9755]
}
bl <- mean(bootci$l)
bu <- mean(bootci$u)
ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=M2012-bl, ymax=M2012+bu), colour="red")
bl
bu
head(bootci)
bootpi <- data.frame(l=rep(NA,1000), u=rep(NA, 1000))
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
res <- sort(residuals(df_lm))
bootpi$l[i] <- res[25]
bootpi$u[i] <- res[9755]
}
bootpi <- data.frame(l=rep(NA,1000), u=rep(NA, 1000))
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
res <- sort(residuals(df_lm))
bootpi$l[i] <- res[25]
bootpi$u[i] <- res[975]
}
summary(bootpi)
bootpi <- data.frame(l=rep(NA,1000), u=rep(NA, 1000))
for (i in 1:1000) {
df <- oly[sample(nrow(oly), replace=TRUE), ]
df_lm <- glm(M2012~M2008, data=df)
res <- sort(residuals(df_lm))
bootpi$l[i] <- min(res)
bootpi$u[i] <- max(res)
}
bl <- sort(bootci$l)[25]
bu <- sort(bootci$u)[975]
summary(bootpi)
bl
bu
bl <- sort(bootpi$l)[25]
bu <- sort(bootpi$u)[975]
dim(b)
bu
bl
p1 <- ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red")
p1
summary(newdat)
newdat$bl <- newdat$M2012+bl
newdat$bu <- newdat$M2012+bu
summary(newdat)
ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red")
p1 <- ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red") +
geom_line(data=bootci, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
p2 <- ggplot(oly) +
geom_line(data=bootci, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=bu), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=M2012-se.fit-0.18375), linetype=1) +
geom_line(data=newdat, aes(x=M2008, y=M2012+se.fit+0.18375), linetype=1)
ylab("M2012") + ggtitle("Comparison with t-intervals")
grid.arrange(p1, p2, ncol=2)
p1 <- ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red") +
geom_line(data=bootci, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
p2 <- ggplot(oly) +
geom_line(data=bootci, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=bootci, aes(x=M2008, y=bu), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=M2012-se.fit-0.18375), linetype=1) +
geom_line(data=newdat, aes(x=M2008, y=M2012+se.fit+0.18375), linetype=1) +
ylab("M2012") + ggtitle("Comparison with t-intervals")
grid.arrange(p1, p2, ncol=2)
ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red") +
geom_line(data=bootpi, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=bootpi, aes(x=M2008, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red") +
geom_line(data=newdat, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
p1 <- ggplot(oly) + geom_point(aes(x=M2008, y=M2012), alpha=0.3) +
geom_abline(intercept=0.10043, slope=0.90103) +
geom_linerange(data=newdat, aes(x=M2008, ymin=bl, ymax=bu), colour="red") +
geom_line(data=newdat, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
p2 <- ggplot(oly) +
geom_line(data=newdat, aes(x=M2008, y=bl), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=bu), linetype=2) +
geom_line(data=newdat, aes(x=M2008, y=M2012-se.fit-0.18375), linetype=1) +
geom_line(data=newdat, aes(x=M2008, y=M2012+se.fit+0.18375), linetype=1) +
ylab("M2012") + ggtitle("Comparison with t-intervals")
grid.arrange(p1, p2, ncol=2)
florida <- read.csv("../data/florida.csv")
p1 <- ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10()
p2 <- ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10() + xlab("log Buchanan counts") + ylab("log Gore counts")
p3 <- ggplot(data=florida, aes(x=Buchanan, y=Bush)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10()
p4 <- ggplot(data=florida, aes(x=Buchanan, y=Bush)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10() + xlab("log Buchanan counts") + ylab("log Bush counts")
grid.arrange(p1, p2, p3, p4, ncol=2)
p1 <- ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1)
p2 <- ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10() + xlab("log Buchanan counts") + ylab("log Gore counts")
p3 <- ggplot(data=florida, aes(x=Buchanan, y=Bush)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1)
p4 <- ggplot(data=florida, aes(x=Buchanan, y=Bush)) + geom_point() + geom_smooth(method="lm", se=F) + theme(aspect.ratio=1) + scale_x_log10() + scale_y_log10() + xlab("log Buchanan counts") + ylab("log Bush counts")
grid.arrange(p1, p2, p3, p4, ncol=2)
head(florida)
florida$County
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_text(filter(florida, County=="PALM BEACH"), aes(label=County))
?geom_text
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_label(filter(florida, County=="PALM BEACH"), aes(label=County))
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_text(data=filter(florida, County=="PALM BEACH"), aes(label=County))
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_text(data=filter(florida, County=="PALM BEACH"), aes(label=County),
vjust="bottom", hjust="left")
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_text(data=filter(florida, County=="PALM BEACH"), aes(label=County),
vjust="bottom", hjust="right")
ggplot(data=florida, aes(x=Buchanan, y=Gore)) + geom_point() +
geom_text(data=filter(florida, County=="PALM BEACH"), aes(label=County),
vjust="top", hjust="right")
glimpse(florida)
florida <- read_csv("../data/florida.csv")
glimpse(florida)
florida_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic+ college+`Income (Thousands)`, data=florida)
florida_lm
florida_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic+ college+`Income (Thousands)`, data=filter(florida, County != "PALM BEACH"))
florida_lm
florida_augment <- augment(florida_lm)
head(florida_augment)
p1 <- ggplot(florida, aes(x=`age 65 (%)`, y=Log_Buchanan)) + geom_point()
p2 <- ggplot(florida, aes(x=Black, y=Log_Buchanan)) + geom_point()
p3 <- ggplot(florida, aes(x=Hispanic, y=Log_Buchanan)) + geom_point()
p4 <- ggplot(florida, aes(x=college, y=Log_Buchanan)) + geom_point()
p5 <- ggplot(florida, aes(x=`Income (Thousands)`, y=Log_Buchanan)) + geom_point()
grid.arrange(p1, p2, p3, p4, p5, ncol=5)
?augment
pb <- florida %>% filter(florida, County=="PALM BEACH")
pb <- florida %>% filter(County=="PALM BEACH")
pb
pb_p <- predict(florida_lm, pb)
pb_e <- pb - pb_p
pb_e <- pb$Log_Buchanan - pb_p
kable(cbind(pb_p, pb_e))
kable(cbind(pb$Log_Buchanan, pb_p, pb_e))
pb
florida_nopb <- florida %>% filter(County!="PALM BEACH")
bootci <- data.frame(florida_nopb, l=rep(NA, nrow(florida_nopb)), u=rep(NA, nrow(florida_nopb)))
for (j in 1:nrow(florida_nopb)) {
x <- florida_nopb[j,]
pred <- NULL
for (i in 1:1000) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
florida_all <- florida
dim(florida)
florida_all$fitted <- predict(florida_lm, florida)
ggplot(florida) + geom_point(aes(x=fitted, y=Log_Buchanan), alpha=0.3) +
geom_linerange(data=bootci, aes(x=fitted, ymin=l, ymax=u), colour="red")
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan), alpha=0.3)
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan)) +
geom_linerange(data=bootci, aes(x=fitted, ymin=l, ymax=u), colour="red")
head(bootci)
bootci$fitted <- predict(florida_lm, bootci)
head(florida_nopb)
florida_nopb <- florida %>% filter(County!="PALM BEACH")
bootci <- data.frame(florida_nopb, l=rep(NA, nrow(florida_nopb)), u=rep(NA, nrow(florida_nopb)))
head(florida_nopb)
for (j in 1:nrow(florida_nopb)) {
x <- florida_nopb[j,]
pred <- NULL
for (i in 1:100) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- mean(c(pred[2],pred[3]))
bootci$u[j] <- mean(c(pred[97], pred[98]))
}
head(bootci)
bootci <- data.frame(florida_nopb, l=rep(NA, nrow(florida_nopb)),
u=rep(NA, nrow(florida_nopb)))
head(bootci)
bootci <- florida_nopb
bootci$l <- NA
bootci$u <- NA
head(bootci)
for (j in 1:nrow(florida_nopb)) {
x <- florida_nopb[j,]
pred <- NULL
for (i in 1:100) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
bootci$l[j] <- mean(c(pred[2],pred[3]))
bootci$u[j] <- mean(c(pred[97], pred[98]))
}
florida_all <- florida
head(bootci)
florida_all$fitted <- predict(florida_lm, florida)
bootci$fitted <- predict(florida_lm, bootci)
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan)) +
geom_linerange(data=bootci, aes(x=fitted, ymin=l, ymax=u), colour="red") +
geom_line(data=bootci, aes(x=fitted, y=l), linetype=2) +
geom_line(data=bootci, aes(x=fitted, y=u), linetype=2) +
ggtitle("Bootstrap ci for predictions")
florida_nopb <- florida %>% filter(County!="PALM BEACH")
bootci <- florida_nopb
bootci$l <- NA
bootci$u <- NA
for (j in 1:nrow(florida_nopb)) {
x <- florida_nopb[j,]
pred <- NULL
for (i in 1:1000) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
#  bootci$l[j] <- mean(c(pred[2],pred[3]))
#  bootci$u[j] <- mean(c(pred[97], pred[98]))
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
florida_all <- florida
florida_all$fitted <- predict(florida_lm, florida)
bootci$fitted <- predict(florida_lm, bootci)
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan)) +
geom_linerange(data=bootci, aes(x=fitted, ymin=l, ymax=u), colour="red") +
geom_line(data=bootci, aes(x=fitted, y=l), linetype=2) +
geom_line(data=bootci, aes(x=fitted, y=u), linetype=2) +
ggtitle("Bootstrap ci for predictions")
warnings()
florida <- read_csv("../data/florida.csv")
florida_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=filter(florida, County != "PALM BEACH"))
florida_augment <- augment(florida_lm, data=filter(florida, County != "PALM BEACH"))
pb <- florida %>% filter(County=="PALM BEACH")
pb_p <- predict(florida_lm, pb)
pb_e <- pb$Log_Buchanan - pb_p
florida_nopb <- florida %>% filter(County!="PALM BEACH")
bootci <- florida_nopb
bootci$l <- NA
bootci$u <- NA
for (j in 1:nrow(florida_nopb)) {
x <- florida_nopb[j,]
pred <- NULL
for (i in 1:1000) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
pred <- c(pred, predict(df_lm, x))
}
pred <- sort(pred)
#  bootci$l[j] <- mean(c(pred[2],pred[3]))
#  bootci$u[j] <- mean(c(pred[97], pred[98]))
bootci$l[j] <- pred[25]
bootci$u[j] <- pred[975]
}
warnings()
florida_all <- florida
florida_all$fitted <- predict(florida_lm, florida)
bootci$fitted <- predict(florida_lm, bootci)
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan)) +
geom_linerange(data=bootci, aes(x=fitted, ymin=l, ymax=u), colour="red") +
geom_line(data=bootci, aes(x=fitted, y=l), linetype=2) +
geom_line(data=bootci, aes(x=fitted, y=u), linetype=2) +
ggtitle("Bootstrap ci for predictions")
florida_augment <- merge(florida_all, florida_augment, by="County", all.x=T)
head(florida_augment)
ggplot(florida_all) +
geom_line(data=bootci, aes(x=fitted, y=l), linetype=2) +
geom_line(data=bootci, aes(x=fitted, y=u), linetype=2) +
geom_line(data=florida_augment, aes(x=fitted, y=fitted-se.fit), linetype=1) +
geom_line(data=florida_augment, aes(x=fitted, y=fitted+se.fit), linetype=1) +
ylab("Log_Buchanan") + ggtitle("Comparison with t-intervals")
head(florida_augment)
ggplot(florida_all) +
geom_line(data=bootci, aes(x=fitted, y=l), linetype=2) +
geom_line(data=bootci, aes(x=fitted, y=u), linetype=2) +
geom_line(data=florida_augment, aes(x=fitted, y=fitted-.se.fit), linetype=1) +
geom_line(data=florida_augment, aes(x=fitted, y=fitted+.se.fit), linetype=1) +
ylab("Log_Buchanan") + ggtitle("Comparison with t-intervals")
df <- data.frame(x=letters[1:5], y=letters[1:5])
df
orig <- letters[1:10]
sample(orig, replace=TRUE)
sort(sample(orig, replace=TRUE))
bootpi <- data.frame(l=rep(NA,1000), u=rep(NA, 1000))
for (i in 1:1000) {
df <- florida_nopb[sample(nrow(florida_nopb), replace=TRUE), ]
df_lm <- glm(Log_Buchanan~`age 65 (%)` + Black + Hispanic +
college + `Income (Thousands)`,
data=df)
res <- sort(residuals(df_lm))
bootpi$l[i] <- min(res)
bootpi$u[i] <- max(res)
}
bl <- sort(bootpi$l)[25]
bu <- sort(bootpi$u)[975]
bl
bu
florida_all$bl <- florida_all$fitted+bl
florida_all$bu <- florida_all$fitted+bu
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan), alpha=0.5) +
geom_linerange(aes(x=fitted, ymin=bl, ymax=bu), colour="red") +
geom_line(aes(x=fitted, y=bl), linetype=2) +
geom_line(aes(x=fitted, y=bu), linetype=2) +
ggtitle("Bootstrap prediction intervals")
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan), alpha=0.5) +
geom_linerange(aes(x=fitted, ymin=bl, ymax=bu), colour="red") +
geom_line(aes(x=fitted, y=bl), linetype=2) +
geom_line(aes(x=fitted, y=bu), linetype=2) +
geom_text(data=filter(florida_all, County=="PALM BEACH"), aes(label=County),
vjust="top", hjust="right") +
ggtitle("Bootstrap prediction intervals")
ggplot(florida_all) + geom_point(aes(x=fitted, y=Log_Buchanan), alpha=0.5) +
geom_linerange(aes(x=fitted, ymin=bl, ymax=bu), colour="red") +
geom_line(aes(x=fitted, y=bl), linetype=2) +
geom_line(aes(x=fitted, y=bu), linetype=2) +
geom_text(data=filter(florida_all, County=="PALM BEACH"),
aes(x=fitted, y=Log_Buchanan, label=County),
vjust="top", hjust="right") +
ggtitle("Bootstrap prediction intervals")
library(HLMdiag)
data(radon)
glimpse(radon)
library(dplyr)
glimpse(radon)
library(lme4)
radon_lmer <- lmer(log.radon ~ basement + uranium +
(basement | county.name), data = radon_sub)
summary(radon_lmer)
radon_lmer_fit <- augment(radon_lmer)
library(lme4)
radon_lmer <- lmer(log.radon ~ basement + uranium +
(basement | county.name), data = radon_sub)
summary(radon_lmer)
radon_lmer_fit <- augment(radon_lmer)
library(broom)
library(HLMdiag)
data(radon)
radon <- radon %>% rename(storey=basement)
glimpse(radon)
library(lme4)
?lmer
?summary.lmer
?var
